<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<select id="findByNo" parameterType="long" resultType="boardvo">
		<![CDATA[
			select a.no, a.title, a.contents, a.reg_date,
				 a.hit, a.g_no, a.o_no, a.depth, a.user_no, b.name
				from board a, user b
			where a.user_no = b.no 
			and a.no=#{no }
		]]>	
	</select>

	<select id="findAll" parameterType="map"  resultType="boardvo">
	<choose>
		<when test='kwd == "" '>
			<![CDATA[
				SELECT a.no, a.title, a.contents, a.hit, 
					a.reg_date, a.g_no, a.o_no, a.depth, b.name, a.user_no 
				 FROM board a , user b 
				 WHERE a.user_no = b.no
					AND a.title like #{kwd } 
				 ORDER BY g_no desc, o_no asc, depth asc limit #{page }, 5
			]]>
		</when>
		<otherwise>
			<![CDATA[				
				select a.no, a.title, a.contents, a.hit,
				   a.reg_date, a.g_no, a.o_no, a.depth, b.name, a.user_no
				from board a , user b
					where a.user_no = b.no
					AND a.title like #{kwd } 
				order by g_no desc, o_no asc, depth asc	limit #{page }, 5	
			]]>
		</otherwise>
	</choose>		
		
	</select>
	
	<select id="totalCount" parameterType="string" resultType="integer">
		<![CDATA[
			SELECT count(*) FROM board
				WHERE title like #{kwd } 
		]]>
	</select>
	
	<update id="updateHit" parameterType="map">
			<![CDATA[
				UPDATE board SET hit = hit + 1
					WHERE no = #{no }
			]]>
	</update>
	
	
</mapper>